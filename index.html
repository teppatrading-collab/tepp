<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Teppa Trading</title>

<link rel="stylesheet" href="style.css">

<!-- Supabase CDN (LOAD ONCE) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<header class="navbar">
  <div class="logo">TEPPA <span>TRADING</span></div>
  <div>
    <button id="loginBtn" class="outline">Login</button>
    <button id="signupBtn" class="outline">Sign Up</button>
    <button id="logoutBtn" class="outline hidden">Logout</button>
  </div>
</header>

<section class="hero">
  <h1>Master Forex & Indices</h1>
  <p>Education • Discipline • Consistency</p>
  <button id="applyBtn" class="cta">Apply For Mentorship</button>
</section>

<!-- AUTH MODAL -->
<div id="authModal" class="modal hidden">
  <div class="modal-box">
    <h2 id="authTitle">Login</h2>

    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">

    <button id="submitAuth" class="cta">Submit</button>

    <p id="forgotPw" style="cursor:pointer;color:#00ffae;margin-top:10px;">
      Forgot password?
    </p>

    <p id="closeModal" style="cursor:pointer;color:#aaa;">Close</p>
  </div>
</div>

<script>
/* =======================
   SUPABASE (SINGLE CLIENT)
======================= */
const supabaseClient = window.supabase.createClient(
  "https://xuifnaypkeeukyjlapi.supabase.co",
  "sb_publishable_44vXTyFg_8x20hqa8KGuA_0V9HX2ob"
);

let mode = "login";

/* =======================
   PASSWORD RECOVERY
======================= */
const hash = window.location.hash;
if (hash.includes("type=recovery")) {
  window.location.href = "/reset-password.html";
}

/* =======================
   MODAL CONTROLS
======================= */
function openAuth(type) {
  mode = type;
  document.getElementById("authTitle").innerText =
    type === "login" ? "Login" : "Sign Up";
  document.getElementById("authModal").classList.remove("hidden");
}

function closeAuth() {
  document.getElementById("authModal").classList.add("hidden");
}

/* =======================
   AUTH HANDLER
======================= */
async function handleAuth() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  if (!email || !password) {
    alert("Enter email and password");
    return;
  }

  const result =
    mode === "login"
      ? await supabaseClient.auth.signInWithPassword({ email, password })
      : await supabaseClient.auth.signUp({ email, password });

  if (result.error) {
    alert(result.error.message);
    return;
  }

  closeAuth();
  updateUI(true);
}

/* =======================
   FORGOT PASSWORD
======================= */
async function forgotPassword() {
  const email = document.getElementById("email").value.trim();
  if (!email) return alert("Enter your email first");

  const { error } =
    await supabaseClient.auth.resetPasswordForEmail(email, {
      redirectTo: window.location.origin,
    });

  alert(error ? error.message : "Password reset email sent");
}

/* =======================
   LOGOUT
======================= */
async function logout() {
  await supabaseClient.auth.signOut();
  updateUI(false);
}

/* =======================
   UI STATE
======================= */
function updateUI(loggedIn) {
  document.getElementById("loginBtn").classList.toggle("hidden", loggedIn);
  document.getElementById("signupBtn").classList.toggle("hidden", loggedIn);
  document.getElementById("logoutBtn").classList.toggle("hidden", !loggedIn);
}

/* =======================
   APPLY BUTTON (SAFE)
======================= */
document.getElementById("applyBtn").onclick = async () => {
  const { data } = await supabaseClient.auth.getSession();

  if (!data.session) {
    openAuth("login");
    return;
  }

  window.location.href = "/dashboard/index.html";
};

/* =======================
   EVENTS
======================= */
document.getElementById("loginBtn").onclick = () => openAuth("login");
document.getElementById("signupBtn").onclick = () => openAuth("signup");
document.getElementById("logoutBtn").onclick = logout;
document.getElementById("submitAuth").onclick = handleAuth;
document.getElementById("closeModal").onclick = closeAuth;
document.getElementById("forgotPw").onclick = forgotPassword;

/* =======================
   INITIAL SESSION CHECK
======================= */
document.addEventListener("DOMContentLoaded", async () => {
  const { data } = await supabaseClient.auth.getSession();
  updateUI(!!data.session);
});
</script>

</body>
</html>
