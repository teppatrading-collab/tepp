<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teppa Trading | Mentorship Application</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root { --primary: #2dd4bf; --bg: #0f172a; --card: rgba(30, 41, 59, 0.8); --text: #f8fafc; --border: #334155; }
        body { background: radial-gradient(circle at top right, #1e293b, #0f172a); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; min-height: 100vh; }
        
        .navbar { padding: 20px 5%; display: flex; justify-content: space-between; background: rgba(15, 23, 42, 0.9); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(10px); }
        .brand { font-weight: 900; font-size: 1.2rem; text-transform: uppercase; color: #fff; }
        .brand span { color: var(--primary); }
        .nav-link { color: #94a3b8; text-decoration: none; margin-left: 20px; font-size: 0.9rem; }
        .nav-link:hover { color: var(--primary); }

        .container { max-width: 600px; margin: 60px auto; padding: 0 20px; }
        
        /* FORM CARD */
        .app-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 40px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .input-group { margin-bottom: 20px; }
        .label { display: block; color: #94a3b8; font-size: 0.85rem; margin-bottom: 8px; font-weight: bold; }
        .input { width: 100%; padding: 12px; background: #0f172a; border: 1px solid var(--border); color: #fff; border-radius: 8px; outline: none; box-sizing: border-box; }
        .input:focus { border-color: var(--primary); }
        
        .btn-submit { width: 100%; padding: 14px; background: var(--primary); color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-submit:hover { opacity: 0.9; transform: translateY(-2px); }

        /* STATUS BADGES */
        .status-box { text-align: center; padding: 40px 20px; }
        .status-icon { font-size: 4rem; margin-bottom: 20px; }
        .status-title { font-size: 1.5rem; margin-bottom: 10px; font-weight: 900; }
        .status-desc { color: #94a3b8; line-height: 1.6; }
        
        .pending { color: #fbbf24; }
        .denied { color: #ef4444; }
        .approved { color: #2dd4bf; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="brand">TEPPA <span>MENTORSHIP</span></div>
        <div><a href="index.html" class="nav-link">Home</a></div>
    </nav>

    <div class="container">
        <div id="loading" style="text-align:center; color:#94a3b8;">Checking application status...</div>

        <div id="applicationForm" class="app-card hidden">
            <h2 style="margin-top:0;">Apply for Mentorship</h2>
            <p style="color:#94a3b8; margin-bottom:30px; font-size:0.9rem;">We only accept 5 traders per month. Be honest.</p>
            
            <div class="input-group">
                <label class="label">Discord Username</label>
                <input id="discord" type="text" class="input" placeholder="Example: trader#1234">
            </div>
            <div class="input-group">
                <label class="label">Years Trading</label>
                <select id="exp" class="input">
                    <option>Less than 1 year</option>
                    <option>1-3 Years</option>
                    <option>3+ Years</option>
                </select>
            </div>
            <div class="input-group">
                <label class="label">Current Trading Capital</label>
                <select id="cap" class="input">
                    <option>Under $1,000</option>
                    <option>$1,000 - $10,000</option>
                    <option>$10,000 - $50,000</option>
                    <option>$50,000+</option>
                </select>
            </div>
            <div class="input-group">
                <label class="label">Why should we accept you?</label>
                <textarea id="why" class="input" rows="4" placeholder="Tell us your goals..."></textarea>
            </div>
            <button onclick="submitApp()" id="submitBtn" class="btn-submit">Submit Application</button>
        </div>

        <div id="statusPending" class="app-card status-box hidden">
            <i class='bx bx-time-five status-icon pending'></i>
            <div class="status-title pending">Application Pending</div>
            <p class="status-desc">Your application has been received and is currently under review by the Teppa team. This usually takes 24-48 hours.</p>
        </div>

        <div id="statusDenied" class="app-card status-box hidden">
            <i class='bx bx-x-circle status-icon denied'></i>
            <div class="status-title denied">Application Declined</div>
            <p class="status-desc">Thank you for your interest. Unfortunately, we cannot offer you a spot in the mentorship at this time. Please focus on the free Academy content and try again in 30 days.</p>
        </div>

        <div id="statusApproved" class="app-card status-box hidden">
            <i class='bx bx-check-circle status-icon approved'></i>
            <div class="status-title approved">You're In!</div>
            <p class="status-desc">Congratulations. Your application stood out. Access the private discord and course material below.</p>
            <button class="btn-submit" style="margin-top:20px;">Enter Private Portal</button>
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://xuifnaypkeeukyjvlapi.supabase.co';
        const supabaseKey = 'sb_publishable_44vXTyFg__8x2Ohqa8KGuA_OV9HX2ob';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        let userEmail = "";
        let userId = "";

        async function init() {
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (!session) {
                // Must be logged in to apply
                alert("Please log in to apply.");
                window.location.href = "index.html"; 
                return;
            }
            userEmail = session.user.email;
            userId = session.user.id;
            checkStatus();
        }
        init();

        async function checkStatus() {
            // Check if row exists
            const { data, error } = await supabaseClient
                .from('mentorship_applications')
                .select('*')
                .eq('user_id', userId)
                .single();

            document.getElementById('loading').classList.add('hidden');

            if (!data) {
                // No application found, show form
                document.getElementById('applicationForm').classList.remove('hidden');
            } else {
                // Application found, check status
                if (data.status === 'pending') document.getElementById('statusPending').classList.remove('hidden');
                if (data.status === 'denied') document.getElementById('statusDenied').classList.remove('hidden');
                if (data.status === 'approved') document.getElementById('statusApproved').classList.remove('hidden');
            }
        }

        async function submitApp() {
            const discord = document.getElementById('discord').value;
            const exp = document.getElementById('exp').value;
            const cap = document.getElementById('cap').value;
            const why = document.getElementById('why').value;

            if(!discord || !why) return alert("Please fill out all fields.");

            document.getElementById('submitBtn').innerText = "Sending...";

            const { error } = await supabaseClient
                .from('mentorship_applications')
                .insert([{ 
                    user_id: userId, 
                    email: userEmail,
                    discord_handle: discord,
                    experience: exp,
                    capital: cap,
                    why_join: why,
                    status: 'pending' 
                }]);

            if (error) {
                alert("Error: " + error.message);
                document.getElementById('submitBtn').innerText = "Submit Application";
            } else {
                // Refresh to show pending screen
                location.reload();
            }
        }
    </script>
</body>
</html>
